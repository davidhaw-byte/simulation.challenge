{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "title: \"Simulation Challenge\"\n",
        "subtitle: \"Generative Models and Monte Carlo Simulation\"\n",
        "format: html\n",
        "execute:\n",
        "  echo: false\n",
        "  eval: true\n",
        "---\n",
        "\n",
        "# üé≤ Simulation Challenge - Monte Carlo Analysis\n",
        "\n",
        "## Challenge Overview\n",
        "\n",
        "**Your Mission:** Create a comprehensive Quarto document that simulates one or two investment strategies, analyzes the results, and demonstrates your ability to present counter-intuitive findings compellingly. Then render the document to HTML and deploy it via GitHub Pages from a new repository called \"simulationChallenge.\"\n",
        "\n",
        "::: {.callout-warning}\n",
        "## ‚ö†Ô∏è AI Partnership Required\n",
        "\n",
        "This challenge pushes boundaries intentionally. You'll tackle problems that normally require weeks of study, but with Cursor AI as your partner (and your brain keeping it honest), you can accomplish more than you thought possible.\n",
        "\n",
        "**The new reality:** The four stages of competence are Ignorance ‚Üí Awareness ‚Üí Learning ‚Üí Mastery. AI lets us produce Mastery-level work while operating primarily in the Awareness stage. I focus on awareness training, you leverage AI for execution, and together we create outputs that used to require years of dedicated study.\n",
        ":::\n",
        "\n",
        "## The Investment Game üéØ\n",
        "\n",
        "```{r}\n",
        "#| label: fig-compounding-simulation\n",
        "#| fig-cap: \"Monte Carlo simulation with compounding account balance\"\n",
        "#| echo: true\n",
        "\n",
        "# Set seed for reproducibility\n",
        "suppressPackageStartupMessages(library(tidyverse))\n",
        "\n",
        "# Set seed for reproducibility\n",
        "set.seed(123)\n",
        "\n",
        "# Number of Coin Flips\n",
        "n_flips <- 35\n",
        "# Initial account balance\n",
        "initial_acct <- 1000\n",
        "\n",
        "# Create simulation data with compounding account balance\n",
        "sim_data <- tibble(\n",
        "  sim_num = 1:n_flips,\n",
        "  coin_flip = rbinom(n = n_flips, size = 1, prob = 0.5)\n",
        ") %>%\n",
        "  mutate(\n",
        "    # Calculate compounding account balance\n",
        "    account_balance = accumulate(\n",
        "      coin_flip, \n",
        "      .init = initial_acct,\n",
        "      .f = ~ if_else(.y == 1, .x * 1.5, .x * 0.6)\n",
        "    )[-1],  # Remove the initial value\n",
        "    # Calculate the change in account balance for each round\n",
        "    balance_change = account_balance - lag(account_balance, default = initial_acct)\n",
        "  )\n",
        "\n",
        "# Display first 10 results\n",
        "head(sim_data, 35)\n",
        "\n",
        "# Summary statistics\n",
        "cat(\"\\nSimulation Summary:\\n\")\n",
        "cat(\"Initial balance: $\", initial_acct, \"\\n\")\n",
        "cat(\"Final balance: $\", round(tail(sim_data$account_balance, 1), 2), \"\\n\")\n",
        "cat(\"Total return: \", round((tail(sim_data$account_balance, 1) / initial_acct - 1) * 100, 2), \"%\\n\")\n",
        "```\n",
        "\n",
        "## Question 1:\n",
        "The expected balance of your account after one coin flip would be $1000 *1.5 = $1500 + $1000 *0.6 = $600 = $2100/2 = $1050. So the expected profit after a coin flip is $1050 - $1000 = $50.\n",
        "\n",
        "## Question 2:\n",
        "This expected value is positive so you should expect to have an account balance much higher than $1000. In this expected value situation, you should always play the game expecting to make a profit.\n",
        "\n",
        "## Question 3:\n",
        "As seen with the visualization below, our ending account balance by the age of 55 is $24,429. When I was 53 I hit the peak account value of $40,716, which sadly dropped down again but I still ended up with a profit of $23,429. The lowest point I had was two years in, at the age of 22, when I dropped to $540 account balance. Overall, I am very happy with the results, as any profit is a good one, especially one of $23,429.\n",
        "\n",
        "## üìà Life-Long Investment Journey Visualization of above simulation\n",
        "\n",
        "```{r}\n",
        "#| label: fig-life-investment\n",
        "#| fig-cap: \"35-year investment journey showing account balance evolution from age 20 to 55\"\n",
        "#| fig-width: 12\n",
        "#| fig-height: 8\n",
        "\n",
        "# Create age-based data\n",
        "sim_data_with_age <- sim_data %>%\n",
        "  mutate(\n",
        "    age = 20 + sim_num - 1,  # Start at age 20\n",
        "    decade = floor(age / 10) * 10,  # Group by decades\n",
        "    age_group = case_when(\n",
        "      age < 30 ~ \"20s\",\n",
        "      age < 40 ~ \"30s\", \n",
        "      age < 50 ~ \"40s\",\n",
        "      TRUE ~ \"50s\"\n",
        "    )\n",
        "  )\n",
        "\n",
        "# Create the main visualization\n",
        "investment_plot <- ggplot(sim_data_with_age, aes(x = age, y = account_balance)) +\n",
        "  # Add background grid\n",
        "  theme_minimal() +\n",
        "  \n",
        "  # Add decade markers\n",
        "  geom_vline(xintercept = seq(20, 55, 10), color = \"gray90\", linetype = \"dotted\", alpha = 0.7) +\n",
        "  \n",
        "  # Add horizontal reference lines\n",
        "  geom_hline(yintercept = initial_acct, color = \"red\", linetype = \"dashed\", alpha = 0.8, size = 1) +\n",
        "  geom_hline(yintercept = initial_acct * 2, color = \"green\", linetype = \"dashed\", alpha = 0.8, size = 1) +\n",
        "  geom_hline(yintercept = initial_acct * 5, color = \"blue\", linetype = \"dashed\", alpha = 0.8, size = 1) +\n",
        "  \n",
        "  # Main line showing account balance\n",
        "  geom_line(color = \"darkblue\", size = 2, alpha = 0.9) +\n",
        "  \n",
        "  # Points colored by win/loss\n",
        "  geom_point(aes(color = factor(coin_flip)), size = 3, alpha = 0.8) +\n",
        "  \n",
        "  # Color scale for wins/losses\n",
        "  scale_color_manual(\n",
        "    values = c(\"0\" = \"#e74c3c\", \"1\" = \"#27ae60\"),\n",
        "    labels = c(\"Loss\", \"Win\"),\n",
        "    name = \"Coin Flip Result\"\n",
        "  ) +\n",
        "  \n",
        "  # Y-axis formatting with even spacing\n",
        "  scale_y_continuous(\n",
        "    labels = scales::dollar_format(),\n",
        "    breaks = seq(0, max(sim_data$account_balance) * 1.1, by = 1000),\n",
        "    limits = c(0, max(sim_data$account_balance) * 1.1)\n",
        "  ) +\n",
        "  \n",
        "  # X-axis formatting\n",
        "  scale_x_continuous(\n",
        "    breaks = seq(20, 55, 5),\n",
        "    limits = c(20, 55)\n",
        "  ) +\n",
        "  \n",
        "  # Labels and title\n",
        "  labs(\n",
        "    title = \"üéØ 35-Year Investment Journey: Monte Carlo Simulation\",\n",
        "    subtitle = paste(\"Starting at $\", scales::comma(initial_acct), \"| Final: $\", scales::comma(round(tail(sim_data$account_balance, 1), 0))),\n",
        "    x = \"Age\",\n",
        "    y = \"Account Balance (Log Scale)\",\n",
        "    caption = \"Red line: Starting balance | Green line: 2x return | Blue line: 5x return\"\n",
        "  ) +\n",
        "  \n",
        "  # Custom theme\n",
        "  theme(\n",
        "    plot.title = element_text(size = 18, face = \"bold\", color = \"#2c3e50\"),\n",
        "    plot.subtitle = element_text(size = 14, color = \"#7f8c8d\", margin = margin(b = 20)),\n",
        "    plot.caption = element_text(size = 10, color = \"#95a5a6\", hjust = 0),\n",
        "    axis.title = element_text(size = 12, face = \"bold\"),\n",
        "    axis.text = element_text(size = 10),\n",
        "    legend.title = element_text(size = 12, face = \"bold\"),\n",
        "    legend.text = element_text(size = 10),\n",
        "    legend.position = \"bottom\",\n",
        "    panel.grid.minor = element_blank(),\n",
        "    panel.grid.major.x = element_blank(),\n",
        "    plot.background = element_rect(fill = \"white\", color = NA),\n",
        "    panel.background = element_rect(fill = \"white\", color = NA)\n",
        "  )\n",
        "\n",
        "# Add annotations for key milestones\n",
        "investment_plot <- investment_plot +\n",
        "  # Annotate starting point\n",
        "  annotate(\"text\", x = 20.5, y = initial_acct * 1.2, \n",
        "           label = \"Starting\\n$1,000\", \n",
        "           size = 3, color = \"red\", fontface = \"bold\") +\n",
        "  \n",
        "  # Annotate final point\n",
        "  annotate(\"text\", x = 54.5, y = tail(sim_data$account_balance, 1) * 1.2, \n",
        "           label = paste(\"Final\\n$\", scales::comma(round(tail(sim_data$account_balance, 1), 0))), \n",
        "           size = 3, color = \"darkblue\", fontface = \"bold\")\n",
        "\n",
        "# Display the plot\n",
        "print(investment_plot)\n",
        "\n",
        "# Calculate and display key statistics\n",
        "cat(\"\\nüìä Investment Journey Statistics:\\n\")\n",
        "cat(\"Starting age: 20\\n\")\n",
        "cat(\"Ending age: 55\\n\")\n",
        "cat(\"Total years: 35\\n\")\n",
        "cat(\"Initial investment: $\", scales::comma(initial_acct), \"\\n\")\n",
        "cat(\"Final balance: $\", scales::comma(round(tail(sim_data$account_balance, 1), 2)), \"\\n\")\n",
        "cat(\"Total return: \", round((tail(sim_data$account_balance, 1) / initial_acct - 1) * 100, 2), \"%\\n\")\n",
        "cat(\"Annualized return: \", round(((tail(sim_data$account_balance, 1) / initial_acct)^(1/35) - 1) * 100, 2), \"%\\n\")\n",
        "cat(\"Win rate: \", round(mean(sim_data$coin_flip) * 100, 1), \"%\\n\")\n",
        "\n",
        "# Show best and worst years\n",
        "max_balance_idx <- which.max(sim_data$account_balance)\n",
        "min_balance_idx <- which.min(sim_data$account_balance)\n",
        "\n",
        "cat(\"\\nüéØ Key Milestones:\\n\")\n",
        "cat(\"Peak balance: $\", scales::comma(round(max(sim_data$account_balance), 2)), \" at age \", 20 + max_balance_idx - 1, \"\\n\")\n",
        "cat(\"Lowest balance: $\", scales::comma(round(min(sim_data$account_balance), 2)), \" at age \", 20 + min_balance_idx - 1, \"\\n\")\n",
        "```\n",
        "\n",
        "## üé≤ Multiple Simulation Analysis (100 Runs)\n",
        "\n",
        "```{r}\n",
        "#| label: fig-multiple-simulations\n",
        "#| fig-cap: \"Analysis of 100 Monte Carlo simulations showing distribution of final outcomes\"\n",
        "#| echo: true\n",
        "\n",
        "# Load required packages\n",
        "suppressPackageStartupMessages(library(tidyverse))\n",
        "\n",
        "# Set parameters for multiple simulations\n",
        "n_simulations <- 100\n",
        "n_flips <- 35  # 35 years from age 20 to 55\n",
        "initial_acct <- 1000\n",
        "\n",
        "# Function to run a single simulation\n",
        "run_single_simulation <- function(sim_id) {\n",
        "  # Generate coin flips for this simulation\n",
        "  coin_flips <- rbinom(n = n_flips, size = 1, prob = 0.5)\n",
        "  \n",
        "  # Calculate account balance over time\n",
        "  account_balance <- accumulate(\n",
        "    coin_flips, \n",
        "    .init = initial_acct,\n",
        "    .f = ~ if_else(.y == 1, .x * 1.5, .x * 0.6)\n",
        "  )[-1]  # Remove initial value\n",
        "  \n",
        "  # Return results for this simulation\n",
        "  tibble(\n",
        "    simulation_id = sim_id,\n",
        "    year = 1:n_flips,\n",
        "    age = 20 + year - 1,\n",
        "    coin_flip = coin_flips,\n",
        "    account_balance = account_balance,\n",
        "    balance_change = account_balance - lag(account_balance, default = initial_acct)\n",
        "  )\n",
        "}\n",
        "\n",
        "# Run 100 simulations\n",
        "cat(\"Running\", n_simulations, \"simulations...\\n\")\n",
        "all_simulations <- map_dfr(1:n_simulations, run_single_simulation)\n",
        "\n",
        "# Calculate final outcomes for each simulation\n",
        "final_outcomes <- all_simulations %>%\n",
        "  filter(year == n_flips) %>%\n",
        "  mutate(\n",
        "    final_return_pct = (account_balance / initial_acct - 1) * 100,\n",
        "    annualized_return = ((account_balance / initial_acct)^(1/35) - 1) * 100,\n",
        "    outcome_category = case_when(\n",
        "      account_balance > initial_acct * 10 ~ \"Outstanding (>10x)\",\n",
        "      account_balance > initial_acct * 5 ~ \"Excellent (5-10x)\",\n",
        "      account_balance > initial_acct * 2 ~ \"Good (2-5x)\",\n",
        "      account_balance > initial_acct ~ \"Profitable (1-2x)\",\n",
        "      TRUE ~ \"Loss (<1x)\"\n",
        "    )\n",
        "  )\n",
        "\n",
        "# Summary statistics\n",
        "cat(\"\\nüìä 100 Simulation Results Summary:\\n\")\n",
        "cat(\"Initial investment: $\", scales::comma(initial_acct), \"\\n\")\n",
        "cat(\"Simulations run: \", n_simulations, \"\\n\")\n",
        "cat(\"Years per simulation: \", n_flips, \"\\n\\n\")\n",
        "\n",
        "cat(\"Final Balance Statistics:\\n\")\n",
        "cat(\"Mean final balance: $\", scales::comma(round(mean(final_outcomes$account_balance), 2)), \"\\n\")\n",
        "cat(\"Median final balance: $\", scales::comma(round(median(final_outcomes$account_balance), 2)), \"\\n\")\n",
        "cat(\"Min final balance: $\", scales::comma(round(min(final_outcomes$account_balance), 2)), \"\\n\")\n",
        "cat(\"Max final balance: $\", scales::comma(round(max(final_outcomes$account_balance), 2)), \"\\n\")\n",
        "cat(\"Standard deviation: $\", scales::comma(round(sd(final_outcomes$account_balance), 2)), \"\\n\\n\")\n",
        "\n",
        "cat(\"Return Statistics:\\n\")\n",
        "cat(\"Mean return: \", round(mean(final_outcomes$final_return_pct), 2), \"%\\n\")\n",
        "cat(\"Median return: \", round(median(final_outcomes$final_return_pct), 2), \"%\\n\")\n",
        "cat(\"Mean annualized return: \", round(mean(final_outcomes$annualized_return), 2), \"%\\n\")\n",
        "cat(\"Median annualized return: \", round(median(final_outcomes$annualized_return), 2), \"%\\n\\n\")\n",
        "\n",
        "# Count outcomes by category\n",
        "outcome_summary <- final_outcomes %>%\n",
        "  count(outcome_category) %>%\n",
        "  mutate(percentage = round(n / n_simulations * 100, 1))\n",
        "\n",
        "cat(\"Outcome Distribution:\\n\")\n",
        "print(outcome_summary)\n",
        "\n",
        "# Calculate probability of different outcomes\n",
        "profitable_sims <- sum(final_outcomes$account_balance > initial_acct)\n",
        "cat(\"\\nüéØ Key Probabilities:\\n\")\n",
        "cat(\"Probability of profit: \", round(profitable_sims / n_simulations * 100, 1), \"%\\n\")\n",
        "cat(\"Probability of 2x+ return: \", round(sum(final_outcomes$account_balance > initial_acct * 2) / n_simulations * 100, 1), \"%\\n\")\n",
        "cat(\"Probability of 5x+ return: \", round(sum(final_outcomes$account_balance > initial_acct * 5) / n_simulations * 100, 1), \"%\\n\")\n",
        "cat(\"Probability of 10x+ return: \", round(sum(final_outcomes$account_balance > initial_acct * 10) / n_simulations * 100, 1), \"%\\n\")\n",
        "cat(\"Probability of loss: \", round(sum(final_outcomes$account_balance < initial_acct) / n_simulations * 100, 1), \"%\\n\")\n",
        "```\n",
        "\n",
        "## üìà Visualization of 100 Simulation Results\n",
        "\n",
        "```{r}\n",
        "#| label: fig-simulation-distribution\n",
        "#| fig-cap: \"Distribution and analysis of final outcomes from 100 Monte Carlo simulations\"\n",
        "#| fig-width: 12\n",
        "#| fig-height: 10\n",
        "\n",
        "# Load required packages\n",
        "suppressPackageStartupMessages(library(tidyverse))\n",
        "\n",
        "# Create object-oriented probability distribution plot\n",
        "probability_distribution_plot <- ggplot(final_outcomes, aes(x = account_balance)) +\n",
        "  # Add density curve (probability distribution)\n",
        "  geom_density(aes(y = after_stat(density)), \n",
        "               fill = \"steelblue\", \n",
        "               alpha = 0.6, \n",
        "               color = \"darkblue\", \n",
        "               linewidth = 1.2) +\n",
        "  \n",
        "  # Add histogram with probability density\n",
        "  geom_histogram(aes(y = after_stat(density)), \n",
        "                 bins = 25, \n",
        "                 fill = \"lightblue\", \n",
        "                 alpha = 0.4, \n",
        "                 color = \"white\", \n",
        "                 linewidth = 0.5) +\n",
        "  \n",
        "  # Add reference lines\n",
        "  geom_vline(xintercept = initial_acct, \n",
        "             color = \"red\", \n",
        "             linetype = \"dashed\", \n",
        "             linewidth = 1.5,\n",
        "             alpha = 0.8) +\n",
        "  \n",
        "  geom_vline(xintercept = median(final_outcomes$account_balance), \n",
        "             color = \"darkgreen\", \n",
        "             linetype = \"solid\", \n",
        "             linewidth = 1.5,\n",
        "             alpha = 0.8) +\n",
        "  \n",
        "  geom_vline(xintercept = mean(final_outcomes$account_balance), \n",
        "             color = \"purple\", \n",
        "             linetype = \"dotted\", \n",
        "             linewidth = 1.5,\n",
        "             alpha = 0.8) +\n",
        "  \n",
        "  # Format axes\n",
        "  scale_x_continuous(\n",
        "    labels = scales::dollar_format(),\n",
        "    breaks = scales::pretty_breaks(n = 8),\n",
        "    limits = c(0, max(final_outcomes$account_balance) * 1.1)\n",
        "  ) +\n",
        "  \n",
        "  scale_y_continuous(\n",
        "    labels = scales::percent_format(),\n",
        "    breaks = scales::pretty_breaks(n = 6)\n",
        "  ) +\n",
        "  \n",
        "  # Add labels and title\n",
        "  labs(\n",
        "    title = \"Probability Distribution of Final Account Balances at Age 55\",\n",
        "    subtitle = paste(\"100 Monte Carlo Simulations | Initial Investment: $\", \n",
        "                     scales::comma(initial_acct), \n",
        "                     \" | Mean: $\", scales::comma(round(mean(final_outcomes$account_balance), 0)),\n",
        "                     \" | Median: $\", scales::comma(round(median(final_outcomes$account_balance), 0))),\n",
        "    x = \"Final Account Balance at Age 55\",\n",
        "    y = \"Probability Density\",\n",
        "    caption = \"Red dashed line: Initial investment | Green solid line: Median | Purple dotted line: Mean\"\n",
        "  ) +\n",
        "  \n",
        "  # Custom theme\n",
        "  theme_minimal() +\n",
        "  theme(\n",
        "    plot.title = element_text(size = 16, face = \"bold\", color = \"#2c3e50\", hjust = 0.5),\n",
        "    plot.subtitle = element_text(size = 12, color = \"#7f8c8d\", hjust = 0.5, margin = margin(b = 15)),\n",
        "    plot.caption = element_text(size = 10, color = \"#95a5a6\", hjust = 0),\n",
        "    axis.title = element_text(size = 12, face = \"bold\"),\n",
        "    axis.text = element_text(size = 10),\n",
        "    panel.grid.minor = element_blank(),\n",
        "    panel.grid.major.x = element_line(color = \"gray90\", linewidth = 0.3),\n",
        "    panel.grid.major.y = element_line(color = \"gray90\", linewidth = 0.3),\n",
        "    plot.background = element_rect(fill = \"white\", color = NA),\n",
        "    panel.background = element_rect(fill = \"white\", color = NA),\n",
        "    plot.margin = margin(20, 20, 20, 20)\n",
        "  )\n",
        "\n",
        "# Display the probability distribution plot\n",
        "print(probability_distribution_plot)\n",
        "```\n",
        "\n",
        "## Question 4:\n",
        "After running the probability distribution, I can see that after 100 simulations the probability \n",
        "distribution looks a little grim. I would say that I am happy that on average I am making money as our \n",
        "mean is 2,758 but the probability of us losing money is too high for my liking. It seems that there is a \n",
        "dense probability that we will lose money so it seems a little risky. Especially since our average is \n",
        "skewed by some very high outliers.\n",
        "```{r}\n",
        "#| label: prob-analysis-1000\n",
        "#| echo: true\n",
        "\n",
        "# Calculate probability of ending above $1,000\n",
        "simulations_above_1000 <- sum(final_outcomes$account_balance > 1000)\n",
        "probability_above_1000 <- simulations_above_1000 / n_simulations * 100\n",
        "\n",
        "# Calculate probability of ending below $1,000 (loss)\n",
        "simulations_below_1000 <- sum(final_outcomes$account_balance < 1000)\n",
        "probability_below_1000 <- simulations_below_1000 / n_simulations * 100\n",
        "\n",
        "# Calculate probability of ending exactly at $1,000 (break-even)\n",
        "simulations_at_1000 <- sum(final_outcomes$account_balance == 1000)\n",
        "probability_at_1000 <- simulations_at_1000 / n_simulations * 100\n",
        "\n",
        "cat(\"RESULTS:\\n\")\n",
        "cat(\"‚Ä¢ Simulations ending ABOVE $1,000: \", simulations_above_1000, \" out of \", n_simulations, \" (\", round(probability_above_1000, 1), \"%)\\n\")\n",
        "cat(\"‚Ä¢ Simulations ending BELOW $1,000: \", simulations_below_1000, \" out of \", n_simulations, \" (\", round(probability_below_1000, 1), \"%)\\n\")\n",
        "cat(\"‚Ä¢ Simulations ending AT $1,000:    \", simulations_at_1000, \" out of \", n_simulations, \" (\", round(probability_at_1000, 1), \"%)\\n\\n\")\n",
        "```\n",
        "\n",
        "## Question 5: \n",
        "In this probability analysis it shows that the probability of the outcome being greater than $1000 is 25%. This is a very low probability for sure leaving me unhappy with the outcome. This probability is definitely too low for me to put down $1000 and risk it being significantly less for only a 25% chance of it growing in value. "
      ]
    }
  ],
  "metadata": {
    "kernelspec": {
      "display_name": "Python 3",
      "language": "python",
      "name": "python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 4
}